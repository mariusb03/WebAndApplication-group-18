{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useLocation}from'react-router-dom';import CourseModal from'../../components/courseModal/CourseModal';import'./AllCoursesPage.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AllCoursesPage=()=>{const location=useLocation();const params=new URLSearchParams(location.search);const searchParam=params.get('search')||'';const[courses,setCourses]=useState([]);const[searchQuery,setSearchQuery]=useState(searchParam);const[selectedCourse,setSelectedCourse]=useState(null);const[user,setUser]=useState(null);const[favourites,setFavourites]=useState([]);useEffect(()=>{const storedUser=JSON.parse(localStorage.getItem('user'));if(storedUser){setUser(storedUser);// Fetch favourites for the logged-in user\nfetch(\"http://localhost:8081/user/\".concat(storedUser.userId,\"/favourites\")).then(res=>res.json()).then(data=>{const favIds=data.map(course=>course.courseId);setFavourites(favIds);}).catch(err=>console.error('Failed to load favourites:',err));}},[]);useEffect(()=>{setSearchQuery(searchParam);},[searchParam]);useEffect(()=>{fetch('http://localhost:8081/api/courses/getAll').then(response=>response.json()).then(data=>setCourses(data)).catch(error=>console.error('Error fetching courses:',error));},[]);const toggleFavourite=courseId=>{if(!user)return;const isFav=favourites.includes(courseId);const method=isFav?'DELETE':'POST';fetch(\"http://localhost:8081/user/\".concat(user.userId,\"/favourite/\").concat(courseId),{method}).then(res=>{if(res.ok){setFavourites(prev=>isFav?prev.filter(id=>id!==courseId):[...prev,courseId]);}else{console.error('Failed to update favourite');}}).catch(err=>console.error('Error updating favourite:',err));};const displayedCourses=courses.filter(course=>{const matchesSearch=course.title.toLowerCase().includes(searchQuery.toLowerCase());const isVisible=(user===null||user===void 0?void 0:user.role)==='admin'||!course.hidden;return matchesSearch&&isVisible;});return/*#__PURE__*/_jsxs(\"div\",{className:\"courses-page\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"All Courses\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"course-search\",placeholder:\"Search for a course...\",value:searchQuery,onChange:e=>setSearchQuery(e.target.value)}),/*#__PURE__*/_jsx(\"div\",{className:\"course-grid\",children:displayedCourses.length>0?displayedCourses.map((course,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"course-card \".concat(course.hidden?'hidden-course':''),onClick:()=>setSelectedCourse(course),children:[/*#__PURE__*/_jsx(\"img\",{src:\"/img/\".concat(course.courseId,\".svg\"),alt:\"Course \".concat(course.title),onError:e=>{e.target.src='/static/img/default.svg';}}),/*#__PURE__*/_jsx(\"h3\",{className:\"course-title\",children:course.title}),(user===null||user===void 0?void 0:user.role)==='admin'&&/*#__PURE__*/_jsx(\"button\",{className:\"toggle-visibility-btn\",onClick:e=>{e.stopPropagation();fetch(\"http://localhost:8081/api/courses/\".concat(course.courseId,\"/toggleVisibility\"),{method:'PUT'}).then(()=>fetch('http://localhost:8081/api/courses/getAll')).then(res=>res.json()).then(updated=>{setCourses(updated);});},children:course.hidden?'Unhide':'Hide'}),user&&/*#__PURE__*/_jsx(\"span\",{className:\"favourite-star \".concat(favourites.includes(course.courseId)?'filled':''),onClick:e=>{e.stopPropagation();toggleFavourite(course.courseId);},children:\"\\u2605\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Price:\"}),\" \",course.price,\" NOK\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Difficulty:\"}),\" \",course.difficulty]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Topic:\"}),\" \",course.category]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Session:\"}),\" \",course.session]}),(user===null||user===void 0?void 0:user.role)==='admin'&&/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"ID:\"}),\" \",course.courseId]})]},index)):/*#__PURE__*/_jsx(\"p\",{children:\"No courses found.\"})}),/*#__PURE__*/_jsx(CourseModal,{course:selectedCourse,onClose:()=>setSelectedCourse(null)})]});};export default AllCoursesPage;","map":{"version":3,"names":["React","useState","useEffect","useLocation","CourseModal","jsx","_jsx","jsxs","_jsxs","AllCoursesPage","location","params","URLSearchParams","search","searchParam","get","courses","setCourses","searchQuery","setSearchQuery","selectedCourse","setSelectedCourse","user","setUser","favourites","setFavourites","storedUser","JSON","parse","localStorage","getItem","fetch","concat","userId","then","res","json","data","favIds","map","course","courseId","catch","err","console","error","response","toggleFavourite","isFav","includes","method","ok","prev","filter","id","displayedCourses","matchesSearch","title","toLowerCase","isVisible","role","hidden","className","children","type","placeholder","value","onChange","e","target","length","index","onClick","src","alt","onError","stopPropagation","updated","price","difficulty","category","session","onClose"],"sources":["/Users/mariusbr/Documents/Data ingeniør/4. Semester/AppDev&WebTech/gruppe oppgave/WebAndApplication-group-18/src/pages/AllCoursesPage/AllCoursesPage.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport CourseModal from '../../components/courseModal/CourseModal';\nimport './AllCoursesPage.css';\n\nconst AllCoursesPage = () => {\n    const location = useLocation();\n    const params = new URLSearchParams(location.search);\n    const searchParam = params.get('search') || '';\n\n    const [courses, setCourses] = useState([]);\n    const [searchQuery, setSearchQuery] = useState(searchParam);\n    const [selectedCourse, setSelectedCourse] = useState(null);\n    const [user, setUser] = useState(null);\n    const [favourites, setFavourites] = useState([]);\n\n    useEffect(() => {\n        const storedUser = JSON.parse(localStorage.getItem('user'));\n        if (storedUser) {\n            setUser(storedUser);\n            // Fetch favourites for the logged-in user\n            fetch(`http://localhost:8081/user/${storedUser.userId}/favourites`)\n                .then(res => res.json())\n                .then(data => {\n                    const favIds = data.map(course => course.courseId);\n                    setFavourites(favIds);\n                })\n                .catch(err => console.error('Failed to load favourites:', err));\n        }\n    }, []);\n\n\n    useEffect(() => {\n        setSearchQuery(searchParam);\n    }, [searchParam]);\n\n    useEffect(() => {\n        fetch('http://localhost:8081/api/courses/getAll')\n            .then(response => response.json())\n            .then(data => setCourses(data))\n            .catch(error => console.error('Error fetching courses:', error));\n    }, []);\n\n    const toggleFavourite = (courseId) => {\n        if (!user) return;\n\n        const isFav = favourites.includes(courseId);\n        const method = isFav ? 'DELETE' : 'POST';\n\n        fetch(`http://localhost:8081/user/${user.userId}/favourite/${courseId}`, {\n            method,\n        })\n            .then(res => {\n                if (res.ok) {\n                    setFavourites(prev =>\n                        isFav ? prev.filter(id => id !== courseId) : [...prev, courseId]\n                    );\n                } else {\n                    console.error('Failed to update favourite');\n                }\n            })\n            .catch(err => console.error('Error updating favourite:', err));\n    };\n\n    const displayedCourses = courses.filter(course => {\n        const matchesSearch = course.title.toLowerCase().includes(searchQuery.toLowerCase());\n        const isVisible = user?.role === 'admin' || !course.hidden;\n        return matchesSearch && isVisible;\n    });\n\n    return (\n        <div className=\"courses-page\">\n            <h1>All Courses</h1>\n\n            <input\n                type=\"text\"\n                className=\"course-search\"\n                placeholder=\"Search for a course...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n            />\n\n            <div className=\"course-grid\">\n                {displayedCourses.length > 0 ? (\n                    displayedCourses.map((course, index) => (\n                        <div\n                            key={index}\n                            className={`course-card ${course.hidden ? 'hidden-course' : ''}`}\n                            onClick={() => setSelectedCourse(course)}\n                        >\n                            <img\n                                src={`/img/${course.courseId}.svg`}\n                                alt={`Course ${course.title}`}\n                                onError={(e) => { e.target.src = '/static/img/default.svg'; }}\n                            />\n                            <h3 className=\"course-title\">{course.title}</h3>\n\n                            {user?.role === 'admin' && (\n                                <button\n                                    className=\"toggle-visibility-btn\"\n                                    onClick={(e) => {\n                                        e.stopPropagation();\n                                        fetch(`http://localhost:8081/api/courses/${course.courseId}/toggleVisibility`, {\n                                            method: 'PUT',\n                                        })\n                                            .then(() => fetch('http://localhost:8081/api/courses/getAll'))\n                                            .then(res => res.json())\n                                            .then(updated => {\n                                                setCourses(updated);\n                                            });\n                                    }}\n                                >\n                                    {course.hidden ? 'Unhide' : 'Hide'}\n                                </button>\n                            )}\n\n                            {user && (\n                                <span\n                                    className={`favourite-star ${favourites.includes(course.courseId) ? 'filled' : ''}`}\n                                    onClick={(e) => {\n                                        e.stopPropagation();\n                                        toggleFavourite(course.courseId);\n                                    }}\n                                >\n                                    ★\n                                </span>\n                            )}\n\n                            <p><strong>Price:</strong> {course.price} NOK</p>\n                            <p><strong>Difficulty:</strong> {course.difficulty}</p>\n                            <p><strong>Topic:</strong> {course.category}</p>\n                            <p><strong>Session:</strong> {course.session}</p>\n                            {user?.role === 'admin' && (\n                                <p><strong>ID:</strong> {course.courseId}</p>\n                            )}\n                        </div>\n                    ))\n                ) : (\n                    <p>No courses found.</p>\n                )}\n            </div>\n\n            <CourseModal\n                course={selectedCourse}\n                onClose={() => setSelectedCourse(null)}\n            />\n        </div>\n    );\n};\n\nexport default AllCoursesPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}